<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE nta PUBLIC '-//Uppaal Team//DTD Flat System 1.1//EN' 'http://www.it.uu.se/research/group/darts/uppaal/flat-1_2.dtd'>
<nta>
	<declaration>// Place global declarations here.
const int N = 5;
typedef int[0, N-1] id_t;

chan call[N], share[N];
int var = 0;</declaration>
	<template>
		<name x="9" y="9">Person</name>
		<parameter>const id_t id, int secret</parameter>
		<declaration>// Place local declarations here.

void add_secret (int var)
{
    secret |= var;
}


bool busy = false;
int caller = -1;
</declaration>
		<location id="id0" x="0" y="229">
			<name x="-42" y="246">receiving</name>
		</location>
		<location id="id1" x="263" y="229">
			<name x="221" y="246">shared</name>
		</location>
		<location id="id2" x="263" y="0">
			<name x="254" y="-34">calling</name>
		</location>
		<location id="id3" x="0" y="0">
			<name x="85" y="-76">ready</name>
		</location>
		<init ref="id3"/>
		<transition>
			<source ref="id2"/>
			<target ref="id1"/>
			<label kind="synchronisation" x="272" y="94">share[id]?</label>
			<label kind="assignment" x="272" y="115">add_secret(var), 
var = 0</label>
		</transition>
		<transition>
			<source ref="id1"/>
			<target ref="id3"/>
			<label kind="assignment" x="119" y="68">busy = false</label>
		</transition>
		<transition>
			<source ref="id0"/>
			<target ref="id1"/>
			<label kind="synchronisation" x="68" y="238">share[caller]!</label>
			<label kind="assignment" x="59" y="255">var = secret</label>
		</transition>
		<transition>
			<source ref="id3"/>
			<target ref="id0"/>
			<label kind="select" x="8" y="93">e : id_t</label>
			<label kind="guard" x="8" y="110">!busy</label>
			<label kind="synchronisation" x="8" y="127">call[e]?</label>
			<label kind="assignment" x="8" y="144">add_secret(var),
var = 0,
caller = e</label>
		</transition>
		<transition>
			<source ref="id3"/>
			<target ref="id2"/>
			<label kind="synchronisation" x="85" y="-59">call[id]!</label>
			<label kind="assignment" x="76" y="-42">busy = true,
var = secret</label>
		</transition>
	</template>
	<system>// Place template instantiations here.
Person0 = Person(0, 1);
Person1 = Person(1, 2);
Person2 = Person(2, 4);
Person3 = Person(3, 8);
Person4 = Person(4, 16);
// List one or more processes to be composed into a system.
system Person0, Person1, Person2, Person3, Person4;
    </system>
	<queries>
	</queries>
</nta>
